<mat-toolbar>
    <span>Dump-Master Melito - Admin console</span>
</mat-toolbar>
<section id='node-tree-content' class='main-content'>
    <mat-sidenav-container>
        <mat-sidenav-content class='node-tree-sidenav-content'>
            <mat-tree #tree [dataSource]="dataSource" [childrenAccessor]="childrenAccessor" class="example-tree">
                <mat-tree-node *matTreeNodeDef="let node">
                  {{node.description}}
                </mat-tree-node>
                <mat-nested-tree-node
                    *matTreeNodeDef="let node; when: hasChild"
                    matTreeNodeToggle [cdkTreeNodeTypeaheadLabel]="node.description">
                  <div class="mat-tree-node">
                    <button mat-icon-button matTreeNodeToggle
                            [attr.aria-label]="'Toggle ' + node.id" *ngIf="hasChild(node) | async">
                      <mat-icon class="mat-icon-rtl-mirror">
                        {{tree.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                      </mat-icon>
                    </button>
                    {{node.description}}
                    <div id='node-more-button' class='node-icon clickable-icon' (click)="setSelectedNode(node, $event); sidenav.open();">
                        <mat-icon aria-hidden="false" aria-label="More icon" fontIcon="open_in_new"></mat-icon>
                    </div>
                    <div id='node-add-button' class='node-icon clickable-icon' (click)='createNode(node)'>
                        <mat-icon aria-hidden="false" aria-label="Add icon" fontIcon="add_circle"></mat-icon>
                    </div>
                    <div id='node-remove-button' class='node-icon red-icon clickable-icon' (click)='deleteNode(node)'>
                        <mat-icon aria-hidden="false" aria-label="Add icon" fontIcon="delete"></mat-icon>
                    </div>
                  </div>
                  <div [class.example-tree-invisible]="!tree.isExpanded(node)"
                      role="group">
                    <ng-container matTreeNodeOutlet></ng-container>
                  </div>
                </mat-nested-tree-node>
              </mat-tree>
        </mat-sidenav-content>
        <mat-sidenav opened mode="side" position="end" #sidenav [(opened)]="opened" (opened)="events.push('open!')"
            (closed)="events.push('close!')" class='node-tree-sidenav'>
            <div style='margin: 1vw;'>
                <mat-card-content *ngIf="selectedNode">
                    <!-- TODO: build a component for the node card -->
                    <label class='node-card-title'>Nodo {{selectedNode.id}}</label>
                    <mat-form-field id='node-description-textarea' class="node-property-textarea">
                        <mat-label>Descrizione</mat-label>
                        <textarea matInput placeholder="" [(ngModel)]="selectedNode!.description"></textarea>
                    </mat-form-field>
                    <mat-form-field id='node-kind-textarea' class="node-property-textarea">
                        <mat-label>Tipo</mat-label>
                        <textarea matInput placeholder="" [(ngModel)]="selectedNode!.kind"></textarea>
                    </mat-form-field>
                    <mat-form-field id='node-text-textarea' class="node-property-textarea">
                        <mat-label>Testo</mat-label>
                        <textarea matInput placeholder="" [(ngModel)]="selectedNode!.text"></textarea>
                    </mat-form-field>
                    <button mat-fab extended (click)='updateNode(selectedNode!)' [disabled]='!hasBeenModified(selectedNode)'>
                      AGGIORNA
                      <mat-icon *ngIf='updateInProgress'>sync</mat-icon>
                      <mat-icon *ngIf='updateCompleted'>check_circle</mat-icon>
                      <mat-icon *ngIf='updateFailed'>error</mat-icon>
                    </button>
                </mat-card-content>
            </div>
        </mat-sidenav>
    </mat-sidenav-container>
</section>